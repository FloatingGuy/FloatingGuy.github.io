<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>AES加密算法回顾 | FloatingGuy's Blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">AES加密算法回顾</h1><a id="logo" href="/.">FloatingGuy's Blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">AES加密算法回顾</h1><div class="post-meta">Jun 9, 2017<span> | </span><span class="category"><a href="/categories/categories-research/">研究</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/06/09/AES加密算法回顾/" href="/2017/06/09/AES加密算法回顾/#comments" class="ds-thread-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#密码学"><span class="toc-number">1.</span> <span class="toc-text">密码学</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#攻击加密算法的方法"><span class="toc-number">1.1.</span> <span class="toc-text">攻击加密算法的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#认识AES-算法"><span class="toc-number">1.2.</span> <span class="toc-text">认识AES 算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现AES-算法"><span class="toc-number">1.3.</span> <span class="toc-text">实现AES 算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#debug"><span class="toc-number">1.3.1.</span> <span class="toc-text">debug</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Todo"><span class="toc-number">2.</span> <span class="toc-text">Todo</span></a></li></ol></div></div><div class="post-content"><p>作者：FloatingGuy 转载请注明出处：<a href="https://floatingguy.github.io/" target="_blank" rel="external">https://floatingguy.github.io/</a></p>
<hr>
<p><img src="/include/img/aes1.JPG" alt=""></p>
<a id="more"></a>
<h1 id="密码学"><a href="#密码学" class="headerlink" title="密码学"></a>密码学</h1><p>密码算法的本质： <strong>替换</strong> 和 <strong>置换</strong></p>
<h2 id="攻击加密算法的方法"><a href="#攻击加密算法的方法" class="headerlink" title="攻击加密算法的方法"></a>攻击加密算法的方法</h2><ul>
<li>差分攻击 Differential attack</li>
<li>线性攻击 Linear attack</li>
</ul>
<h2 id="认识AES-算法"><a href="#认识AES-算法" class="headerlink" title="认识AES 算法"></a>认识AES 算法</h2><p><a href="https://zh.wikipedia.org/wiki/%E9%AB%98%E7%BA%A7%E5%8A%A0%E5%AF%86%E6%A0%87%E5%87%86" target="_blank" rel="external">AES 加密算法</a> – Rijndael</p>
<p>Rijndael 的特性:</p>
<ul>
<li>rijndael  加密不采用 算术运算。</li>
<li>数据块长度 128bit, 192bit, 256bit</li>
<li>密钥长度 128bit, 192bit, 256bit</li>
<li>数据块和密钥长度相互独立</li>
<li>运算的轮数可变</li>
<li>因为不采用算数运算，所有处理器硬件的差异对其影响较小</li>
<li>轮变换可以并行处理</li>
<li>不使用替换盒</li>
<li>子密钥生成速度快</li>
<li>潜在的平行运算</li>
</ul>
<p>应用到AES 时对数据块长度做出规定，必须是128bit.</p>
<p>AES加密过程是在一个4×4的字节矩阵上运作，这个矩阵又称为“体（state）”，其初值就是一个明文区块（矩阵中一个元素大小就是明文区块中的一个Byte）。（Rijndael加密法因支持更大的区块，其矩阵行数可视情况增加）加密时，各轮AES加密循环（除最后一轮外）均包含4个步骤：</p>
<ol>
<li><code>MixColumns</code>—为了充分混合矩阵中各个直行的操作。这个步骤使用线性转换来混合每内联的四个字节。</li>
<li><code>SubBytes</code>—通过一个非线性的替换函数，用查找表的方式把每个字节替换成对应的字节。</li>
<li><code>ShiftRows</code>—将矩阵中的每个横列进行循环式移位。</li>
<li><code>AddRoundKey</code>—矩阵中的每一个字节都与该次回合密钥（round key）做XOR运算；每个子密钥由密钥生成方案产生。<br>在第一轮前，whitening AK 操作被执行；最后一个加密循环中省略MixColumns步骤，而以另一个AddRoundKey取代。</li>
</ol>
<p>每一个步骤具体的操作原理，请参考<a href="https://zh.wikipedia.org/wiki/%E9%AB%98%E7%BA%A7%E5%8A%A0%E5%AF%86%E6%A0%87%E5%87%86" target="_blank" rel="external">维基百科</a></p>
<h2 id="实现AES-算法"><a href="#实现AES-算法" class="headerlink" title="实现AES 算法"></a>实现AES 算法</h2><p>这类代码网上很多了, 我随便搜到了这篇 <a href="http://www.cnblogs.com/luop/p/4334160.html" target="_blank" rel="external">密码算法详解——AES</a>。 文章还没有细看只看了评论，方便后期学习 我这里贴下部分代码，<a href="https://github.com/openluopworld/aes_128" target="_blank" rel="external">完整代码</a></p>
<h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><p>如果实现完测试发现 解密结果不正确， 那么就要分别排除是 <code>加密</code>环节 还是<code>解密</code>环节出现了问题，我的方法是使用<a href="http://tool.oschina.net/encrypt" target="_blank" rel="external">在线加解密网站</a>对比我们代码得到的结果。</p>
<p>确定了bug的范围，剩下的工作就是参考算法原理重新撸流程了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line"> *</div><div class="line"> * Chinese Academy of Sciences</div><div class="line"> * State Key Laboratory of Information Security</div><div class="line"> * Institute of Information Engineering</div><div class="line"> *</div><div class="line"> * Copyright (C) 2016 Chinese Academy of Sciences</div><div class="line"> *</div><div class="line"> * LuoPeng, luopeng@iie.ac.cn</div><div class="line"> * Updated in Oct 2016</div><div class="line"> * Updated in Jan 2017, update muliple function on GF(2^8).</div><div class="line"> *</div><div class="line"> */</div><div class="line">#include &lt;stdint.h&gt;</div><div class="line">#include &lt;stdio.h&gt;</div><div class="line"></div><div class="line">#include &quot;aes.h&quot;</div><div class="line"></div><div class="line">/*</div><div class="line"> * round constants</div><div class="line"> */</div><div class="line">static uint8_t RC[] = &#123;0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36&#125;;</div><div class="line"></div><div class="line">/*</div><div class="line"> * Sbox</div><div class="line"> */</div><div class="line">static uint8_t SBOX[256] = &#123;</div><div class="line">    0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76,</div><div class="line">    0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0,</div><div class="line">    0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15,</div><div class="line">    0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75,</div><div class="line">    0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84,</div><div class="line">    0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf,</div><div class="line">    0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8,</div><div class="line">    0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2,</div><div class="line">    0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73,</div><div class="line">    0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb,</div><div class="line">    0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79,</div><div class="line">    0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08,</div><div class="line">    0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a,</div><div class="line">    0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e,</div><div class="line">    0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf,</div><div class="line">    0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16&#125;;</div><div class="line"></div><div class="line">/*</div><div class="line"> * Inverse Sboxs</div><div class="line"> */</div><div class="line">static uint8_t INV_SBOX[256] = &#123;</div><div class="line">    0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb,</div><div class="line">    0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb,</div><div class="line">    0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e,</div><div class="line">    0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25,</div><div class="line">    0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92,</div><div class="line">    0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84,</div><div class="line">    0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06,</div><div class="line">    0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b,</div><div class="line">    0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73,</div><div class="line">    0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e,</div><div class="line">    0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b,</div><div class="line">    0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4,</div><div class="line">    0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f,</div><div class="line">    0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef,</div><div class="line">    0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61,</div><div class="line">    0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d&#125;;</div><div class="line"></div><div class="line">/**</div><div class="line"> * https://en.wikipedia.org/wiki/Finite_field_arithmetic</div><div class="line"> * Multiply two numbers in the GF(2^8) finite field defined</div><div class="line"> * by the polynomial x^8 + x^4 + x^3 + x + 1 = 0</div><div class="line"> * We do use mul2(int8_t a) but not mul(uint8_t a, uint8_t b)</div><div class="line"> * just in order to get a higher speed.</div><div class="line"> */</div><div class="line">static inline uint8_t mul2(uint8_t a) &#123;</div><div class="line">    return (a&amp;0x80) ? ((a&lt;&lt;1)^0x1b) : (a&lt;&lt;1);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> * @purpose:    ShiftRows</div><div class="line"> * @descrption:</div><div class="line"> *  Row0: s0  s4  s8  s12   &lt;&lt;&lt; 0 byte</div><div class="line"> *  Row1: s1  s5  s9  s13   &lt;&lt;&lt; 1 byte</div><div class="line"> *  Row2: s2  s6  s10 s14   &lt;&lt;&lt; 2 bytes</div><div class="line"> *  Row3: s3  s7  s11 s15   &lt;&lt;&lt; 3 bytes</div><div class="line"> */</div><div class="line">static void shift_rows(uint8_t *state) &#123;</div><div class="line">    uint8_t temp;</div><div class="line">    // row1</div><div class="line">    temp        = *(state+1);</div><div class="line">    *(state+1)  = *(state+5);</div><div class="line">    *(state+5)  = *(state+9);</div><div class="line">    *(state+9)  = *(state+13);</div><div class="line">    *(state+13) = temp;</div><div class="line">    // row2</div><div class="line">    temp        = *(state+2);</div><div class="line">    *(state+2)  = *(state+10);</div><div class="line">    *(state+10) = temp;</div><div class="line">    temp        = *(state+6);</div><div class="line">    *(state+6)  = *(state+14);</div><div class="line">    *(state+14) = temp;</div><div class="line">    // row3</div><div class="line">    temp        = *(state+15);</div><div class="line">    *(state+15) = *(state+11);</div><div class="line">    *(state+11) = *(state+7);</div><div class="line">    *(state+7)  = *(state+3);</div><div class="line">    *(state+3)  = temp;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> * @purpose:    Inverse ShiftRows</div><div class="line"> * @description</div><div class="line"> *  Row0: s0  s4  s8  s12   &gt;&gt;&gt; 0 byte</div><div class="line"> *  Row1: s1  s5  s9  s13   &gt;&gt;&gt; 1 byte</div><div class="line"> *  Row2: s2  s6  s10 s14   &gt;&gt;&gt; 2 bytes</div><div class="line"> *  Row3: s3  s7  s11 s15   &gt;&gt;&gt; 3 bytes</div><div class="line"> */</div><div class="line">static void inv_shift_rows(uint8_t *state) &#123;</div><div class="line">    uint8_t temp;</div><div class="line">    // row1</div><div class="line">    temp        = *(state+13);</div><div class="line">    *(state+13) = *(state+9);</div><div class="line">    *(state+9)  = *(state+5);</div><div class="line">    *(state+5)  = *(state+1);</div><div class="line">    *(state+1)  = temp;</div><div class="line">    // row2</div><div class="line">    temp        = *(state+14);</div><div class="line">    *(state+14) = *(state+6);</div><div class="line">    *(state+6)  = temp;</div><div class="line">    temp        = *(state+10);</div><div class="line">    *(state+10) = *(state+2);</div><div class="line">    *(state+2)  = temp;</div><div class="line">    // row1</div><div class="line">    temp        = *(state+3);</div><div class="line">    *(state+3)  = *(state+7);</div><div class="line">    *(state+7)  = *(state+11);</div><div class="line">    *(state+11) = *(state+15);</div><div class="line">    *(state+15) = temp;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void aes_key_schedule_128(const uint8_t *key, uint8_t *roundkeys) &#123;</div><div class="line"></div><div class="line">    uint8_t temp[4];</div><div class="line">    uint8_t *last4bytes; // point to the last 4 bytes of one round</div><div class="line">    uint8_t *lastround;</div><div class="line">    uint8_t i;</div><div class="line"></div><div class="line">    for (i = 0; i &lt; 16; ++i) &#123;</div><div class="line">        *roundkeys++ = *key++;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    last4bytes = roundkeys-4;</div><div class="line">    for (i = 0; i &lt; AES_ROUNDS; ++i) &#123;</div><div class="line">        // k0-k3 for next round</div><div class="line">        temp[3] = SBOX[*last4bytes++];</div><div class="line">        temp[0] = SBOX[*last4bytes++];</div><div class="line">        temp[1] = SBOX[*last4bytes++];</div><div class="line">        temp[2] = SBOX[*last4bytes++];</div><div class="line">        temp[0] ^= RC[i];</div><div class="line">        lastround = roundkeys-16;</div><div class="line">        *roundkeys++ = temp[0] ^ *lastround++;</div><div class="line">        *roundkeys++ = temp[1] ^ *lastround++;</div><div class="line">        *roundkeys++ = temp[2] ^ *lastround++;</div><div class="line">        *roundkeys++ = temp[3] ^ *lastround++;</div><div class="line">        // k4-k7 for next round</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">        // k8-k11 for next round</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">        // k12-k15 for next round</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void aes_encrypt_128(const uint8_t *roundkeys, const uint8_t *plaintext, uint8_t *ciphertext) &#123;</div><div class="line"></div><div class="line">    uint8_t tmp[16], t;</div><div class="line">    uint8_t i, j;</div><div class="line"></div><div class="line">    // first AddRoundKey</div><div class="line">    for ( i = 0; i &lt; AES_BLOCK_SIZE; ++i ) &#123;</div><div class="line">        *(ciphertext+i) = *(plaintext+i) ^ *roundkeys++;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 9 rounds</div><div class="line">    for (j = 1; j &lt; AES_ROUNDS; ++j) &#123;</div><div class="line"></div><div class="line">        // SubBytes</div><div class="line">        for (i = 0; i &lt; AES_BLOCK_SIZE; ++i) &#123;</div><div class="line">            *(tmp+i) = SBOX[*(ciphertext+i)];</div><div class="line">        &#125;</div><div class="line">        shift_rows(tmp);</div><div class="line">        /*</div><div class="line">         * MixColumns</div><div class="line">         * [02 03 01 01]   [s0  s4  s8  s12]</div><div class="line">         * [01 02 03 01] . [s1  s5  s9  s13]</div><div class="line">         * [01 01 02 03]   [s2  s6  s10 s14]</div><div class="line">         * [03 01 01 02]   [s3  s7  s11 s15]</div><div class="line">         */</div><div class="line">        for (i = 0; i &lt; AES_BLOCK_SIZE; i+=4)  &#123;</div><div class="line">            t = tmp[i] ^ tmp[i+1] ^ tmp[i+2] ^ tmp[i+3];</div><div class="line">            ciphertext[i]   = mul2(tmp[i]   ^ tmp[i+1]) ^ tmp[i]   ^ t;</div><div class="line">            ciphertext[i+1] = mul2(tmp[i+1] ^ tmp[i+2]) ^ tmp[i+1] ^ t;</div><div class="line">            ciphertext[i+2] = mul2(tmp[i+2] ^ tmp[i+3]) ^ tmp[i+2] ^ t;</div><div class="line">            ciphertext[i+3] = mul2(tmp[i+3] ^ tmp[i]  ) ^ tmp[i+3] ^ t;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // AddRoundKey</div><div class="line">        for ( i = 0; i &lt; AES_BLOCK_SIZE; ++i ) &#123;</div><div class="line">            *(ciphertext+i) ^= *roundkeys++;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // last round</div><div class="line">    for (i = 0; i &lt; AES_BLOCK_SIZE; ++i) &#123;</div><div class="line">        *(ciphertext+i) = SBOX[*(ciphertext+i)];</div><div class="line">    &#125;</div><div class="line">    shift_rows(ciphertext);</div><div class="line">    for ( i = 0; i &lt; AES_BLOCK_SIZE; ++i ) &#123;</div><div class="line">        *(ciphertext+i) ^= *roundkeys++;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">void aes_decrypt_128(const uint8_t *roundkeys, const uint8_t *ciphertext, uint8_t *plaintext) &#123;</div><div class="line"></div><div class="line">    uint8_t tmp[16];</div><div class="line">    uint8_t t, u, v;</div><div class="line">    uint8_t i, j;</div><div class="line"></div><div class="line">    roundkeys += 160;</div><div class="line"></div><div class="line">    // first round</div><div class="line">    for ( i = 0; i &lt; AES_BLOCK_SIZE; ++i ) &#123;</div><div class="line">        *(plaintext+i) = *(plaintext+i) ^ *(roundkeys+i);</div><div class="line">    &#125;</div><div class="line">    roundkeys -= 16;</div><div class="line">    inv_shift_rows(plaintext);</div><div class="line">    for (i = 0; i &lt; AES_BLOCK_SIZE; ++i) &#123;</div><div class="line">        *(plaintext+i) = INV_SBOX[*(plaintext+i)];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    for (j = 1; j &lt; AES_ROUNDS; ++j) &#123;</div><div class="line"></div><div class="line">        // Inverse AddRoundKey</div><div class="line">        for ( i = 0; i &lt; AES_BLOCK_SIZE; ++i ) &#123;</div><div class="line">            *(tmp+i) = *(plaintext+i) ^ *(roundkeys+i);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        /*</div><div class="line">         * Inverse MixColumns</div><div class="line">         * [0e 0b 0d 09]   [s0  s4  s8  s12]</div><div class="line">         * [09 0e 0b 0d] . [s1  s5  s9  s13]</div><div class="line">         * [0d 09 0e 0b]   [s2  s6  s10 s14]</div><div class="line">         * [0b 0d 09 0e]   [s3  s7  s11 s15]</div><div class="line">         */</div><div class="line">        for (i = 0; i &lt; AES_BLOCK_SIZE; i+=4) &#123;</div><div class="line">            t = tmp[i] ^ tmp[i+1] ^ tmp[i+2] ^ tmp[i+3];</div><div class="line">            plaintext[i]   = t ^ tmp[i]   ^ mul2(tmp[i]   ^ tmp[i+1]);</div><div class="line">            plaintext[i+1] = t ^ tmp[i+1] ^ mul2(tmp[i+1] ^ tmp[i+2]);</div><div class="line">            plaintext[i+2] = t ^ tmp[i+2] ^ mul2(tmp[i+2] ^ tmp[i+3]);</div><div class="line">            plaintext[i+3] = t ^ tmp[i+3] ^ mul2(tmp[i+3] ^ tmp[i]);</div><div class="line">            u = mul2(mul2(tmp[i]   ^ tmp[i+2]));</div><div class="line">            v = mul2(mul2(tmp[i+1] ^ tmp[i+3]));</div><div class="line">            t = mul2(u ^ v);</div><div class="line">            plaintext[i]   ^= t ^ u;</div><div class="line">            plaintext[i+1] ^= t ^ v;</div><div class="line">            plaintext[i+2] ^= t ^ u;</div><div class="line">            plaintext[i+3] ^= t ^ v;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // Inverse ShiftRows</div><div class="line">        inv_shift_rows(plaintext);</div><div class="line"></div><div class="line">        // Inverse SubBytes</div><div class="line">        for (i = 0; i &lt; AES_BLOCK_SIZE; ++i) &#123;</div><div class="line">            *(plaintext+i) = INV_SBOX[*(plaintext+i)];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        roundkeys -= 16;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // last AddRoundKey</div><div class="line">    for ( i = 0; i &lt; AES_BLOCK_SIZE; ++i ) &#123;</div><div class="line">        *(plaintext+i) ^= *(roundkeys+i);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后再来2张当年的PPT<br><img src="/include/img/aes2.JPG" alt=""><br><img src="/include/img/aes3.JPG" alt=""></p>
<h1 id="Todo"><a href="#Todo" class="headerlink" title="Todo"></a>Todo</h1><ul>
<li>测试代码，撸流程</li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/06/09/AES加密算法回顾/" data-id="cj46nqux1001h8cv2b0yhspin" class="article-share-link">分享到</a><div class="tags"><a href="/tags/密码学/">密码学</a></div><div class="post-nav"><a href="/2017/06/18/开发/Xposed-Hook-操作手册/" class="pre">Xposed Hook 操作手册</a><a href="/2017/05/24/预览Object-C基础教程/" class="next">预览Object-C基础教程</a></div><div data-thread-key="2017/06/09/AES加密算法回顾/" data-title="AES加密算法回顾" data-url="http://yoursite.com/2017/06/09/AES加密算法回顾/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/06/09/AES加密算法回顾/" data-title="AES加密算法回顾" data-url="http://yoursite.com/2017/06/09/AES加密算法回顾/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/开发/">开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/categories-fiddle/">捣鼓</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/categories-exploit/">漏洞</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/categories-life/">生活</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/categories-research/">研究</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书/">读书</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/逆向/">逆向</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/CIA/" style="font-size: 15px;">CIA</a> <a href="/tags/hook/" style="font-size: 15px;">hook</a> <a href="/tags/了解/" style="font-size: 15px;">了解</a> <a href="/tags/kext/" style="font-size: 15px;">kext</a> <a href="/tags/xnu/" style="font-size: 15px;">xnu</a> <a href="/tags/mach/" style="font-size: 15px;">mach</a> <a href="/tags/public-intelligence/" style="font-size: 15px;">public intelligence</a> <a href="/tags/blackhat-2016/" style="font-size: 15px;">blackhat-2016</a> <a href="/tags/熟悉/" style="font-size: 15px;">熟悉</a> <a href="/tags/逻辑思维/" style="font-size: 15px;">逻辑思维</a> <a href="/tags/密码学/" style="font-size: 15px;">密码学</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/ART虚拟机/" style="font-size: 15px;">ART虚拟机</a> <a href="/tags/Android-OS/" style="font-size: 15px;">Android OS</a> <a href="/tags/抓包/" style="font-size: 15px;">抓包</a> <a href="/tags/https/" style="font-size: 15px;">https</a> <a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/app漏洞/" style="font-size: 15px;">app漏洞</a> <a href="/tags/蓝牙/" style="font-size: 15px;">蓝牙</a> <a href="/tags/OLLVM/" style="font-size: 15px;">OLLVM</a> <a href="/tags/混淆/" style="font-size: 15px;">混淆</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/ios/" style="font-size: 15px;">ios</a> <a href="/tags/jeb/" style="font-size: 15px;">jeb</a> <a href="/tags/动态调试/" style="font-size: 15px;">动态调试</a> <a href="/tags/Armv8-64/" style="font-size: 15px;">Armv8-64</a> <a href="/tags/魔方/" style="font-size: 15px;">魔方</a> <a href="/tags/小说/" style="font-size: 15px;">小说</a> <a href="/tags/读书笔记/" style="font-size: 15px;">读书笔记</a> <a href="/tags/软实力/" style="font-size: 15px;">软实力</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/AppVeyor/" style="font-size: 15px;">AppVeyor</a> <a href="/tags/CI/" style="font-size: 15px;">CI</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/cocoa-app/" style="font-size: 15px;">cocoa app</a> <a href="/tags/C/" style="font-size: 15px;">C</a> <a href="/tags/c/" style="font-size: 15px;">c</a> <a href="/tags/xposed/" style="font-size: 15px;">xposed</a> <a href="/tags/tweak/" style="font-size: 15px;">tweak</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/frida/" style="font-size: 15px;">frida</a> <a href="/tags/pi/" style="font-size: 15px;">pi</a> <a href="/tags/ios-osx/" style="font-size: 15px;">ios/osx</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/06/21/iOS-免越狱注入技术/">iOS 免越狱注入技术</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/21/iOS-供应配置文件和代码签名/">iOS 供应配置文件和代码签名</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/18/开发/Xposed-Hook-操作手册/">Xposed Hook 操作手册</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/09/AES加密算法回顾/">AES加密算法回顾</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/24/预览Object-C基础教程/">预览Object-C基础教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/23/Needle初探/">Needle初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/22/OLLVM-基础学习/">OLLVM 基础学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/22/Bug-pip-安装module的bug/">[Bug] pip 安装module的bug</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/22/Aflred-创建workflows/">Aflred 创建workflows</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/18/开发/C内敛汇编/">C内敛汇编</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 资源链接</i></div><ul></ul><a href="http://bbs.pediy.com/" title="看雪论坛" target="_blank">看雪论坛</a><ul></ul><a href="http://ddeville.me/" title="Damien DeVille" target="_blank">Damien DeVille</a><ul></ul><a href="http://nirvan.360.cn/blog/?cat=2" title="360Nirvan Team" target="_blank">360Nirvan Team</a><ul></ul><a href="https://googleprojectzero.blogspot.jp/" title="Project Zero" target="_blank">Project Zero</a><ul></ul><a href="http://shell-storm.org/blog/Triton-under-the-hood/" title="Jonathan Salwan" target="_blank">Jonathan Salwan</a><ul></ul><a href="http://cocoahuke.com/" title="Cocoa ‘for iOS/Mac’" target="_blank">Cocoa ‘for iOS/Mac’</a><ul></ul><a href="http://whereisk0shl.top/" title="whereisk0shl" target="_blank">whereisk0shl</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">FloatingGuy's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'floatingguy'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?0550af547bfca45329cbf2afcc9fde43";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>