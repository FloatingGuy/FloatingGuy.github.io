<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>浅谈Tweak 开发 | FloatingGuy's Blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">浅谈Tweak 开发</h1><a id="logo" href="/.">FloatingGuy's Blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">浅谈Tweak 开发</h1><div class="post-meta">Apr 30, 2017<span> | </span><span class="category"><a href="/categories/开发/">开发</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/04/30/开发/浅谈Tweak-开发/" href="/2017/04/30/开发/浅谈Tweak-开发/#comments" class="ds-thread-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#环境配置"><span class="toc-number">1.</span> <span class="toc-text">环境配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Theos-使用方法"><span class="toc-number">2.</span> <span class="toc-text">Theos 使用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#文件结构"><span class="toc-number">2.1.</span> <span class="toc-text">文件结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Makefile"><span class="toc-number">2.1.1.</span> <span class="toc-text">Makefile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#control"><span class="toc-number">2.1.2.</span> <span class="toc-text">control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iOSREProject-plist"><span class="toc-number">2.1.3.</span> <span class="toc-text">iOSREProject.plist</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tweak-xm"><span class="toc-number">2.1.4.</span> <span class="toc-text">Tweak.xm</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编译-打包-安装"><span class="toc-number">2.2.</span> <span class="toc-text">编译 + 打包 + 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">2.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#逆向tweak"><span class="toc-number">3.</span> <span class="toc-text">逆向tweak</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#control-文件"><span class="toc-number">3.1.</span> <span class="toc-text">control 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#data-目录"><span class="toc-number">3.2.</span> <span class="toc-text">data 目录</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Logos-语法"><span class="toc-number">4.</span> <span class="toc-text">Logos 语法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#指令集"><span class="toc-number">4.1.</span> <span class="toc-text">指令集</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cydia-Substrate-hook-iOS"><span class="toc-number">5.</span> <span class="toc-text">Cydia Substrate hook iOS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MobileHooker"><span class="toc-number">5.1.</span> <span class="toc-text">MobileHooker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MSHookFunction"><span class="toc-number">5.1.1.</span> <span class="toc-text">MSHookFunction(...)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSHookMessageEx"><span class="toc-number">5.1.2.</span> <span class="toc-text">MSHookMessageEx(...)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MobileLoader"><span class="toc-number">5.2.</span> <span class="toc-text">MobileLoader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Safe-mode"><span class="toc-number">5.3.</span> <span class="toc-text">Safe mode</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#其他技术"><span class="toc-number">6.</span> <span class="toc-text">其他技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#检查是否加壳"><span class="toc-number">6.1.</span> <span class="toc-text">检查是否加壳</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Bugs"><span class="toc-number">7.</span> <span class="toc-text">Bugs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#lzma"><span class="toc-number">7.1.</span> <span class="toc-text">lzma</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dpkg-降级"><span class="toc-number">7.2.</span> <span class="toc-text">dpkg 降级</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">8.</span> <span class="toc-text">Reference</span></a></li></ol></div></div><div class="post-content"><p>作者：FloatingGuy 转载请注明出处：<a href="https://floatingguy.github.io/" target="_blank" rel="external">https://floatingguy.github.io/</a></p>
<hr>
<a id="more"></a>
<h1 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h1><p>详情参考：<a href="http://iphonedevwiki.net/index.php/Cydia_Substrate#Example_code" target="_blank" rel="external">iOS 越狱的Tweak开发</a></p>
<p>新版的已经是内置CydiaSubstrate.framework,不是网上其它教程中说的需要运行bootstrap.sh脚本或者是从手机上拷贝等方式.</p>
<h1 id="Theos-使用方法"><a href="#Theos-使用方法" class="headerlink" title="Theos 使用方法"></a>Theos 使用方法</h1><p>Theos 当前有12种模板，这里拿书中的 iOSREProject tweak 工程的例子做演示。</p>
<ul>
<li><p>创建项目<br><code>nic.pl</code></p>
</li>
<li><p>模板类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">iOS_Tweak $ nic.pl</div><div class="line">NIC 2.0 - New Instance Creator</div><div class="line">------------------------------</div><div class="line">  [1.] iphone/activator_event</div><div class="line">  [2.] iphone/application_modern</div><div class="line">  [3.] iphone/cydget</div><div class="line">  [4.] iphone/flipswitch_switch</div><div class="line">  [5.] iphone/framework</div><div class="line">  [6.] iphone/ios7_notification_center_widget</div><div class="line">  [7.] iphone/library</div><div class="line">  [8.] iphone/notification_center_widget</div><div class="line">  [9.] iphone/preference_bundle_modern</div><div class="line">  [10.] iphone/tool</div><div class="line">  [11.] iphone/tweak</div><div class="line">  [12.] iphone/xpc_service</div></pre></td></tr></table></figure>
</li>
</ul>
<p>初级阶段常用的类型是：2, 10, 11,</p>
<ul>
<li><p>项目类型：<br>Choose a Template (required): <code>11</code></p>
</li>
<li><p>工程名称：<br>Project Name (required): <code>iOSREProject</code></p>
</li>
<li><p>deb 包名<br>Package Name [com.yourcompany.iosreproject]: <code>com.iosre.iosreproject</code></p>
</li>
<li><p>tweak 作者：<br>Author/Maintainer Name [xx]: <code>xx</code></p>
</li>
<li><p>tweak 作用的对象（指定要 hook的目标APP 的 bundle identifier）<br>[iphone/tweak] MobileSubstrate Bundle filter [com.apple.springboard]: <code>com.apple.springboard</code></p>
</li>
<li><p>tweak 安装完以后要重启的应用<br>[iphone/tweak] List of applications to terminate upon installation (space-separated, ‘-‘ for none) [SpringBoard]: <code>SpringBoard</code></p>
</li>
</ul>
<p>Instantiating iphone/tweak in iosreproject/…<br>Done.</p>
<h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><p>当前创建了一个 tweak 项目，在工程目录下只有4个文件：</p>
<p><a href="#m">Makefile</a><br><a href="#c">control</a><br><a href="#i">iOSREProject.plist</a><br><a href="#t">Tweak.xm</a></p>
<h3 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a><span id="m">Makefile</span></h3><p>这是一个编译脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#### 额外的编译参数</span></div><div class="line"><span class="comment"># 目标的 ip</span></div><div class="line">THEOS_DEVICE_IP = iosIP</div><div class="line"></div><div class="line"><span class="comment"># 处理器架构</span></div><div class="line">ARCHS = armv7 arm64</div><div class="line"></div><div class="line"><span class="comment"># SDK 版本</span></div><div class="line"><span class="comment"># TARGET = iphone: BASE SDK 编译使用的 SDK 版本:  Deployment target 发布的机型系统版本</span></div><div class="line"><span class="comment"># TARGET = iphone:latest:8.0</span></div><div class="line">TARGET = iphone:8.1:8.0</div><div class="line"></div><div class="line"><span class="comment"># 必须导入的标准编译脚本</span></div><div class="line">include $(THEOS)/makefiles/common.mk</div><div class="line"></div><div class="line"><span class="comment"># Project name</span></div><div class="line">TWEAK_NAME = iOSREProject</div><div class="line"></div><div class="line"><span class="comment"># Source files</span></div><div class="line">iOSREProject_FILES = Tweak.xm</div><div class="line"></div><div class="line"><span class="comment"># 根据选择的模板类型 导入编译脚本</span></div><div class="line">include $(THEOS_MAKE_PATH)/tweak.mk</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 导入 framework</span></div><div class="line">iOSREProject_FRAMEWORKS = UIKit CoreTelephony CoreAudio</div><div class="line"></div><div class="line"><span class="comment"># 导入 privete framework</span></div><div class="line">iOSREProject_PRIVATE_FRAMEWORKS = AppSupport ChatKit IMCore BaseBoard</div><div class="line"></div><div class="line"><span class="comment"># 安装以后, 自动执行的命令</span></div><div class="line">after-install::</div><div class="line">    install.exec <span class="string">"killall -9 SpringBoard"</span></div></pre></td></tr></table></figure>
<blockquote>
<p>注意：private framework 中导入的包可能存在兼容性问题。比如 BaseBoard 这个 private framework只存在 8.0及以上版本的 SDK 里。这种情况在 ios7中无法正常运行，通过弱链接（makefile weak linking）或者 dlopen/dlsym/dlclose 系列函数调用 private framework。</p>
</blockquote>
<h3 id="control"><a href="#control" class="headerlink" title="control"></a><span id="c">control</span></h3><p>control 中的信息会显示在 Cydia 中, 且 control 文件中内容可以修改。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Package: com.iosre.iosreproject   <span class="comment">#deb 包名</span></div><div class="line">Name: iOSREProject</div><div class="line"></div><div class="line"><span class="comment"># 当前ios 版本必须 高于8.0, 且安装 CydiaSubstarte</span></div><div class="line">Depends: mobilesubstrate, firmware (&gt;=8.0)</div><div class="line"></div><div class="line">Version: 0.0.1</div><div class="line">Architecture: iphoneos-arm      <span class="comment"># 目标设备的  架构</span></div><div class="line">Description: An awesome MobileSubstrate tweak!</div><div class="line">Maintainer: xy</div><div class="line">Author: xx</div><div class="line">Section: Tweaks     <span class="comment">#模板类型</span></div></pre></td></tr></table></figure></p>
<p>更多字段在 debian 的官网。</p>
<h3 id="iOSREProject-plist"><a href="#iOSREProject-plist" class="headerlink" title="iOSREProject.plist"></a><span id="i">iOSREProject.plist</span></h3><p>此 plist 文件的作用和 app 开发时的 plist 文件作用相似， 记录配置信息 描述了 tweak 的作用范围。</p>
<p>Filter 包含 3类数组</p>
<ul>
<li>Bundles<ul>
<li>指定 tweak 起作用的APP &lt; “bundle identifier” &gt;</li>
</ul>
</li>
<li>Executables<ul>
<li>指定作用的 可执行文件 &lt;文件名&gt;</li>
</ul>
</li>
<li>Classes<ul>
<li>指定 作用的 class &lt;类名&gt;</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意: 当Filter 下包含不同的 Array 时需要添加一个 “Mode : Any”, 当只有一个 Array 时不需要。</p>
</blockquote>
<p><span id="plist"></span><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    Filter = &#123;</div><div class="line">        Mode = Any;</div><div class="line">        Executables = (</div><div class="line">            callservicesd,</div><div class="line">            imagent,</div><div class="line">            mediaserverd,</div><div class="line">        );</div><div class="line">        Classes = (</div><div class="line">            NSString,</div><div class="line">            SBIconModel,</div><div class="line">        );</div><div class="line">        Bundles = (</div><div class="line">            "com.apple.springboard",</div><div class="line">            "com.apple.AddressBook",</div><div class="line">        );</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>校验 plist 文件格式：<br><code>plutil -lint xx/xx/iOSREProject.plist</code></p>
<p>不熟悉 xml 语法，使用 xcode 编辑.</p>
<h3 id="Tweak-xm"><a href="#Tweak-xm" class="headerlink" title="Tweak.xm"></a><span id="t">Tweak.xm</span></h3><p>Tweak.xm 后缀 <code>xm</code> 代码文件使用的编程语言。<br><code>x</code> 源文件支持 Logos 和 C语法<br><code>xm</code> 源文件支持Logos 和 C/ C++ 语法</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// hook 住 SpringBoard 类里的 _menuButtonDown 函数</span></div><div class="line">%hook SpringBoard</div><div class="line">- (<span class="keyword">void</span>) _menuButtonDown:(id)down</div><div class="line">&#123;</div><div class="line">    NSLog(@<span class="string">"pressed home button"</span>);</div><div class="line">    %<span class="built_in">log</span>((NSString *)@<span class="string">"iOSRE"</span>, (NSString *)@<span class="string">"Debug"</span>);</div><div class="line">    %orig;</div><div class="line">&#125;</div><div class="line"></div><div class="line">%<span class="keyword">new</span></div><div class="line">- (<span class="keyword">void</span>)namespaceNewMethod</div><div class="line">&#123;</div><div class="line">    NSLog(@<span class="string">"add a new method to class SpringBoard"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">%end</div><div class="line"></div><div class="line">%hook SBLockScreenDateViewController</div><div class="line">- (<span class="keyword">void</span>)setCustomSubtitleText:(id)arg1 withColor:(id)arg2</div><div class="line">&#123;</div><div class="line">    <span class="comment">// 在锁屏界面显示 "iOS 8 App Reverse Engineering"</span></div><div class="line">    %orig(@<span class="string">"iOS 8 App Reverse Engineering"</span>,  arg2);</div><div class="line">&#125;</div><div class="line">%end</div><div class="line"></div><div class="line">%group iOS7Hook</div><div class="line">%hook iOS7Class</div><div class="line">- (id)iOS7Method</div><div class="line">&#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line">%end   <span class="comment">//hook</span></div><div class="line">%end   <span class="comment">//group</span></div><div class="line"></div><div class="line">%group iOS8Hook</div><div class="line">%hook iOS8Class</div><div class="line">- (id)iOS8Method</div><div class="line">&#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line">%end   <span class="comment">//hook</span></div><div class="line">%end   <span class="comment">//group</span></div><div class="line"></div><div class="line">%ctor</div><div class="line">&#123;</div><div class="line">  %init()   <span class="comment">//初始化 _ungrouped %group</span></div><div class="line">  <span class="comment">// %init(iOS7Hook)   // 初始化 iOS7Hook %group</span></div><div class="line">  <span class="comment">// %init(iOS8Hook)   // 初始化 iOS8Hook %group</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Logos 函数使用 % 开头。<br>这里用户定义了2个 group(iOS7Hook 和 iOS8Hook), 并且显示定义了 %ctor 负责初始化要使用的 group</p>
<h2 id="编译-打包-安装"><a href="#编译-打包-安装" class="headerlink" title="编译 + 打包 + 安装"></a>编译 + 打包 + 安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">make    // 没有任何文件创建</div><div class="line">make package</div><div class="line">make package install    // 提前在 Makefile 中配置目标 ip</div></pre></td></tr></table></figure>
<p>安装是通过 ssh 命令实现，要求越狱的 iOS 安装 OpenSSH, 需要在 makefile 中设置 <code>THEOS_DEVICE_IP</code>。<br>还可以配置 公钥登录， 具体步骤略。</p>
<p><img src="/include/img/ios_tweak.png" alt="锁屏界面文字替换"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上面使用大量篇幅介绍开发 tweak 的流程略显啰嗦，其实 tweak 开发的本质就是 Cydia Substrate 的 hook。<br>hook 的目标进程、可执行文件、类：通过 <projectname>.plist 文件控制<br>具体的 hook 代码：定义在 xm 文件中，可以使用 Object-C/C/C++ 开发<br>hook 实现：通过 Logos 语法封装。</projectname></p>
<p><strong>更多关于 tweak 的高级玩法和 其框架的限制，还要在未来的实践中去摸索</strong></p>
<h1 id="逆向tweak"><a href="#逆向tweak" class="headerlink" title="逆向tweak"></a>逆向tweak</h1><p>将deb 包解压会有2个重要的压缩文件：</p>
<ul>
<li><code>control.tar.gz</code>  安装控制文件</li>
<li><code>data.tar.lzma</code>   二进制程序（动态库，可执行文件等）<br>最后那个后缀是压缩类型，可能是lzma, gz，xz等。</li>
</ul>
<p>解压上面的压缩包以后得到 control文件 和 data 目录。</p>
<h2 id="control-文件"><a href="#control-文件" class="headerlink" title="control 文件"></a>control 文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Package: com.iosre.iosreproject</div><div class="line">Name: iOSREProject</div><div class="line">Depends: mobilesubstrate</div><div class="line">Architecture: iphoneos-arm</div><div class="line">Description: An awesome MobileSubstrate tweak!</div><div class="line">Maintainer: xxx</div><div class="line">Author: xxx</div><div class="line">Section: Tweaks</div><div class="line">Version: 0.0.1-4+debug</div><div class="line">Installed-Size: 136</div></pre></td></tr></table></figure>
<h2 id="data-目录"><a href="#data-目录" class="headerlink" title="data 目录"></a>data 目录</h2><p>我逆向了某个 tweak 解压data.tar.gz 发现Library 下有3个文件夹，而我写的ioreproject只有MobileSubstrate一个文件夹。<br><img src="/include/img/ios/tweak_data.png" alt=""></p>
<p>后来发现 PreferenceBundles 下面是一个设置里的一个插件（我们先不关注这个）。<br>直接分析 动态库 <code>/data/Library/MobileSubstrate/DynamicLibraries/</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">__ZL55_logos_method$_ungrouped$SpringBoard$namespaceNewMethodP11SpringBoardP13objc_selector:        // _logos_method$_ungrouped$SpringBoard$namespaceNewMethod(SpringBoard*, objc_selector*)</div><div class="line">00007d70         push       &#123;r7, lr&#125;</div><div class="line">00007d72         mov        r7, sp</div><div class="line">00007d74         sub        sp, #0x8</div><div class="line">00007d76         movw       r2, #0x2fa</div><div class="line">00007d7a         movt       r2, #0x0                                            ; 0x2fa</div><div class="line">00007d7e         add        r2, pc                                              ; @&quot;add a new method to class SpringBoard&quot;</div><div class="line">00007d80         str        r0, [sp, #0x8 + var_4]</div><div class="line">00007d82         str        r1, [sp, #0x8 + var_0]</div><div class="line">00007d84         mov        r0, r2</div><div class="line">00007d86         blx        imp___picsymbolstub4__NSLog</div><div class="line">00007d8a         add        sp, #0x8</div><div class="line">00007d8c         pop        &#123;r7, pc&#125;</div><div class="line">                        ; endp</div><div class="line"> */</div><div class="line"></div><div class="line">%new</div><div class="line">- (void)namespaceNewMethod</div><div class="line">&#123;</div><div class="line">  NSLog(@&quot;add a new method to class SpringBoard&quot;);</div><div class="line">&#125;</div><div class="line">%end</div></pre></td></tr></table></figure></p>
<p>采用标准的arm 汇编， 和android so 一样。</p>
<h1 id="Logos-语法"><a href="#Logos-语法" class="headerlink" title="Logos 语法"></a>Logos 语法</h1><h2 id="指令集"><a href="#指令集" class="headerlink" title="指令集"></a>指令集</h2><ul>
<li><code>%log</code> 在%hook 内部使用。</li>
<li><code>%orig</code> 执行被 hook 的函数的原始代码</li>
<li><code>%group</code> 便于代码管理及按条件初始化分组。不属于某个自定义group 的 hook ， 默认归类到%group _ungrouped<br><strong>group 必须要配置 %init 使用才能生效。</strong></li>
<li><code>%init</code> 只有调用了%init(group name) 才能使对应的%group 起作用</li>
<li><code>%ctor</code> tweak 的构造函数, 完成初始化工作; 如果不定义,theos 会自动生成一个%ctor</li>
<li><code>%c</code> 动态获取一个类的定义</li>
<li><code>%new</code>  给一个现有的 class，添加新函数</li>
</ul>
<table>
<thead>
<tr>
<th>指令</th>
<th>作用域</th>
</tr>
</thead>
<tbody>
<tr>
<td>%hook</td>
<td>%group</td>
</tr>
<tr>
<td>%log</td>
<td>%hook</td>
</tr>
<tr>
<td>%orig</td>
<td>%hook</td>
</tr>
<tr>
<td>%init</td>
<td>%hook , %ctor</td>
</tr>
<tr>
<td>%c</td>
<td>%hook , %ctor</td>
</tr>
</tbody>
</table>
<p>Logos 语言的本质是theos对cydia Substrate提供的函数的宏封装。</p>
<h1 id="Cydia-Substrate-hook-iOS"><a href="#Cydia-Substrate-hook-iOS" class="headerlink" title="Cydia Substrate hook iOS"></a>Cydia Substrate hook iOS</h1><p><a href="http://iphonedevwiki.net/index.php/Cydia_Substrate#Example_code" target="_blank" rel="external">Cydia Substrate</a>由三部分组成, 需要在越狱手机上通过 Cydia 安装。</p>
<ul>
<li>MobileHooker</li>
<li>MobileLoader</li>
<li>Safe mode</li>
</ul>
<h2 id="MobileHooker"><a href="#MobileHooker" class="headerlink" title="MobileHooker"></a>MobileHooker</h2><p>此模块专门用来实现 hook, 下面3个函数就来执行 hook操作。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">IMP MSHookMessage(Class class, SEL selector, IMP replacement, const char* prefix);  // prefix should be NULL.</div><div class="line"></div><div class="line">void MSHookMessageEx(Class class, SEL selector, IMP replacement, IMP *result);</div><div class="line"></div><div class="line">void MSHookFunction(void* function, void* replacement, void** p_original);</div></pre></td></tr></table></figure></p>
<p>上面三个函数都是用来 hook，主要区别在于hook 的语言。</p>
<ul>
<li>针对 C/C++ 函数, 使用 <code>MSHookFunction(...)</code>,  使用 inline hook 的原理在函数头部添加汇编指令跳转。</li>
<li>针对 Object-C 函数, 使用 <code>MSHookMessageEx(...)</code>, 使用 OC 语言特性。</li>
</ul>
<p><code>MSHookFunction(...)</code> 和 <code>MSHookMessageEx(...)</code> 使用案例， 熟悉 hook 的 api 方便逆向 (不展示 hook C++ private method 的代码)</p>
<h3 id="MSHookFunction"><a href="#MSHookFunction" class="headerlink" title="MSHookFunction(...)"></a><code>MSHookFunction(...)</code></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">MSHook(<span class="keyword">void</span>, CFShow, CFTypeRef obj) &#123;           <span class="comment">// our replacement of CFShow().</span></div><div class="line">  <span class="built_in">printf</span>(<span class="string">"Calling original CFShow(%p)..."</span>, obj);</div><div class="line">  _CFShow(obj);                                 <span class="comment">// calls the original CFShow.</span></div><div class="line">  <span class="built_in">printf</span>(<span class="string">" done.\n"</span>);</div><div class="line">&#125;</div><div class="line">...</div><div class="line"><span class="comment">// hook CFShow to our own implementation.</span></div><div class="line">MSHookFunction(CFShow, MSHake(CFShow));</div><div class="line"><span class="comment">// From now on any call to CFShow will pass through our CFShow replacement first.</span></div><div class="line">...</div><div class="line">CFShow(CFSTR(<span class="string">"test"</span>));</div></pre></td></tr></table></figure>
<h3 id="MSHookMessageEx"><a href="#MSHookMessageEx" class="headerlink" title="MSHookMessageEx(...)"></a><code>MSHookMessageEx(...)</code></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> IMP original_UIView_setFrame_;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">replaced_UIView_setFrame_</span><span class="params">(UIView* self, SEL _cmd, CGRect frame)</span> </span>&#123;  <span class="comment">// Note the implicit self and _cmd parameters are needed explicitly here.</span></div><div class="line">  CGRect originalFrame = self.frame;</div><div class="line">  NSLog(<span class="string">"Changing frame of %p from %@ to %@"</span>, self, NSStringFromCGRect(originalFrame), NSStringFromCGRect(frame));</div><div class="line">  original_UIView_setFrame_(self, _cmd, frame);    <span class="comment">// Remember to pass self and _cmd.</span></div><div class="line">&#125;</div><div class="line">...</div><div class="line">MSHookMessageEx([UIView <span class="keyword">class</span>], @selector(setFrame:), (IMP)replaced_UIView_setFrame_, (IMP *)&amp;original_UIView_setFrame_);</div><div class="line">...</div><div class="line">myView.frame = CGRectMake(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</div></pre></td></tr></table></figure>
<p>实际上 CydiaSubstarte 提供的 api 远不止上面的3个，还有很多功能的 api，比如：MSFindSymbole(..)、MSGetImageByName(…)等等，在<a href="http://www.cydiasubstrate.com/api/c/" target="_blank" rel="external">官方文档</a>中均有介绍。</p>
<p>这三个都是用来进行hook操作的,也就是我们在非越狱开发中常说的swizzle! cydia Substrate还提供了MobileLoader：“钩子”需要在运行时被加载，靠的就是MobileLoader的功劳。MobileLoader会在适当的时机加载<code>/Library/MobileSubstrate/DynamicLibraries/</code>目录下的动态库（.dylib，这是tweak的最终产品）</p>
<h2 id="MobileLoader"><a href="#MobileLoader" class="headerlink" title="MobileLoader"></a>MobileLoader</h2><p>此模块用来加载手机中的 tweak，这些 tweak 最终是以 dylib 库的形式保存在<code>/Library/MobileSubstrate/DynamicLibraries/</code>目录下。</p>
<p>需要注意的是 MobileLoader 的作用范围并不是全局 hook。 还记得我们在上面介绍的 <a href="#plist">plist 文件吗</a>，其中只定义了Filter 过滤器，用来过滤要 hook 的目标进程、目标可执行文件、以及目标类。<br>那么 MobileLoader 就会根据 plist 中过滤器指定的作用范围，有选择的在不同进程里通过 dlopen 加载对应的 dylib。</p>
<p><strong>注意</strong>：从 ios9 开始必须定义 plist 文件。没有相应的plist的Dylib将不被加载。 要复制以前没有过滤器plist的效果，导致将dylib加载到所有进程中，请将Filter设置为com.apple.Security。</p>
<p><img src="/include/img/loader.png" alt=""></p>
<h2 id="Safe-mode"><a href="#Safe-mode" class="headerlink" title="Safe mode"></a>Safe mode</h2><p>为了防止编写的 tweak 不规范导致整个进程崩溃，所以 添加了 Safe Mode，它可以捕获 一下6种信号，然后进入安全模式。</p>
<ul>
<li>SIGABRT</li>
<li>SIGILL</li>
<li>SIGBUS</li>
<li>SIGSEGV</li>
<li>SIGSYS</li>
</ul>
<h1 id="其他技术"><a href="#其他技术" class="headerlink" title="其他技术"></a>其他技术</h1><h2 id="检查是否加壳"><a href="#检查是否加壳" class="headerlink" title="检查是否加壳"></a>检查是否加壳</h2><p><code>otool -l WeChat.app/WeChat | grep -B 2 crypt</code></p>
<p>1代表加密了，0代表被解密了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">         cmd LC_ENCRYPTION_INFO</div><div class="line">      cmdsize 20</div><div class="line">     cryptoff 16384</div><div class="line">    cryptsize 16384</div><div class="line">      cryptid 0</div><div class="line">--</div><div class="line">          cmd LC_ENCRYPTION_INFO_64</div><div class="line">      cmdsize 24</div><div class="line">     cryptoff 16384</div><div class="line">    cryptsize 16384</div><div class="line">      cryptid 0</div></pre></td></tr></table></figure></p>
<h1 id="Bugs"><a href="#Bugs" class="headerlink" title="Bugs"></a>Bugs</h1><h2 id="lzma"><a href="#lzma" class="headerlink" title="lzma"></a>lzma</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&apos;dpkg-deb: error: obsolete compression type &apos;lzma&apos;; use xz instead&apos;</div></pre></td></tr></table></figure>
<p><a href="http://bbs.iosre.com/t/daemon/5847" target="_blank" rel="external">解决方案</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">修改opt/theos/makefiles/package/deb.mk</div><div class="line">第六行：THEOSPLATFORM_DPKG_DEB_COMPRESSION ?= lzma</div><div class="line">把最后lzma 改成 xz 就可以了</div></pre></td></tr></table></figure></p>
<h2 id="dpkg-降级"><a href="#dpkg-降级" class="headerlink" title="dpkg 降级"></a>dpkg 降级</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">dpkg: error processing archive /tmp/_theos_install.deb (--install):</div><div class="line"> subprocess dpkg-deb --fsys-tarfile returned error exit status 2</div><div class="line">Errors were encountered while processing:</div><div class="line"> /tmp/_theos_install.deb</div><div class="line">make: *** [internal-install] Error 1</div></pre></td></tr></table></figure>
<p><a href="http://bbs.iosre.com/t/theos-make-install/6706" target="_blank" rel="external">解决方案</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">brew remove dpkg</div><div class="line">HOMEBREW_NO_AUTO_UPDATE=1 brew install https://raw.githubusercontent.com/Homebrew/homebrew-core/7a4dabfc1a2acd9f01a1670fde4f0094c4fb6ffa/Formula/dpkg.rb</div><div class="line">brew pin dpkg</div></pre></td></tr></table></figure></p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1></div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/04/30/开发/浅谈Tweak-开发/" data-id="cj31m0ijd005p88v2iwb7nu5i" class="article-share-link">分享到</a><div class="tags"><a href="/tags/ios/">ios</a><a href="/tags/tweak/">tweak</a></div><div class="post-nav"><a href="/2017/05/03/CIA-武器库/" class="pre">CIA 武器库</a><a href="/2017/04/28/开发/iOS开发中的UDID和UUID/" class="next">iOS开发中的UDID和UUID</a></div><div data-thread-key="2017/04/30/开发/浅谈Tweak-开发/" data-title="浅谈Tweak 开发" data-url="http://yoursite.com/2017/04/30/开发/浅谈Tweak-开发/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/04/30/开发/浅谈Tweak-开发/" data-title="浅谈Tweak 开发" data-url="http://yoursite.com/2017/04/30/开发/浅谈Tweak-开发/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/开发/">开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/categories-fiddle/">捣鼓</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/categories-exploit/">漏洞</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/categories-life/">生活</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/categories-research/">研究</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书/">读书</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/逆向/">逆向</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Android-OS/" style="font-size: 15px;">Android OS</a> <a href="/tags/hook/" style="font-size: 15px;">hook</a> <a href="/tags/了解/" style="font-size: 15px;">了解</a> <a href="/tags/xnu/" style="font-size: 15px;">xnu</a> <a href="/tags/mach/" style="font-size: 15px;">mach</a> <a href="/tags/kext/" style="font-size: 15px;">kext</a> <a href="/tags/public-intelligence/" style="font-size: 15px;">public intelligence</a> <a href="/tags/熟悉/" style="font-size: 15px;">熟悉</a> <a href="/tags/blackhat-2016/" style="font-size: 15px;">blackhat-2016</a> <a href="/tags/逻辑思维/" style="font-size: 15px;">逻辑思维</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/抓包/" style="font-size: 15px;">抓包</a> <a href="/tags/https/" style="font-size: 15px;">https</a> <a href="/tags/ART虚拟机/" style="font-size: 15px;">ART虚拟机</a> <a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/CIA/" style="font-size: 15px;">CIA</a> <a href="/tags/app漏洞/" style="font-size: 15px;">app漏洞</a> <a href="/tags/蓝牙/" style="font-size: 15px;">蓝牙</a> <a href="/tags/ios/" style="font-size: 15px;">ios</a> <a href="/tags/jeb/" style="font-size: 15px;">jeb</a> <a href="/tags/动态调试/" style="font-size: 15px;">动态调试</a> <a href="/tags/Armv8-64/" style="font-size: 15px;">Armv8-64</a> <a href="/tags/小说/" style="font-size: 15px;">小说</a> <a href="/tags/魔方/" style="font-size: 15px;">魔方</a> <a href="/tags/读书笔记/" style="font-size: 15px;">读书笔记</a> <a href="/tags/软实力/" style="font-size: 15px;">软实力</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/AppVeyor/" style="font-size: 15px;">AppVeyor</a> <a href="/tags/CI/" style="font-size: 15px;">CI</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/c/" style="font-size: 15px;">c</a> <a href="/tags/C/" style="font-size: 15px;">C</a> <a href="/tags/frida/" style="font-size: 15px;">frida</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/tweak/" style="font-size: 15px;">tweak</a> <a href="/tags/pi/" style="font-size: 15px;">pi</a> <a href="/tags/ios-osx/" style="font-size: 15px;">ios/osx</a> <a href="/tags/cocoa-app/" style="font-size: 15px;">cocoa app</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/05/23/Needle初探/">Needle初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/22/Bug-pip-安装module的bug/">[Bug] pip 安装module的bug</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/22/Aflred-创建workflows/">Aflred 创建workflows</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/18/开发/C内敛汇编/">C内敛汇编</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/17/如何提高技术写作水平？/">如何提高技术类文章写作水平？</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/15/Android-ART-虚拟机学习-一-框架-模块/">Android ART 虚拟机学习(一) -- 框架/模块</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/15/CVE-2017-0601-Android-蓝牙app-漏洞/">CVE-2017-0601 Android 蓝牙app 漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/03/CIA-武器库/">CIA 武器库</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/30/开发/浅谈Tweak-开发/">浅谈Tweak 开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/28/开发/iOS开发中的UDID和UUID/">iOS开发中的UDID和UUID</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 资源链接</i></div><ul></ul><a href="http://bbs.pediy.com/" title="看雪论坛" target="_blank">看雪论坛</a><ul></ul><a href="http://ddeville.me/" title="Damien DeVille" target="_blank">Damien DeVille</a><ul></ul><a href="http://nirvan.360.cn/blog/?cat=2" title="360Nirvan Team" target="_blank">360Nirvan Team</a><ul></ul><a href="https://googleprojectzero.blogspot.jp/" title="Project Zero" target="_blank">Project Zero</a><ul></ul><a href="http://shell-storm.org/blog/Triton-under-the-hood/" title="Jonathan Salwan" target="_blank">Jonathan Salwan</a><ul></ul><a href="http://cocoahuke.com/" title="Cocoa ‘for iOS/Mac’" target="_blank">Cocoa ‘for iOS/Mac’</a><ul></ul><a href="http://whereisk0shl.top/" title="whereisk0shl" target="_blank">whereisk0shl</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">FloatingGuy's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'floatingguy'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?0550af547bfca45329cbf2afcc9fde43";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>